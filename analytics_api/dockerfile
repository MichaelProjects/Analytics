FROM rust:1.54.0 as builder
ENV USER root
WORKDIR analytics_api
COPY . .
RUN rustup default nightly
RUN rustup update
RUN cargo build --release

FROM ubuntu:21.04
RUN useradd -u 8877 notroot
USER notroot
RUN apt update && apt install postgresql-client -y
COPY --from=builder /analytics_api/target/release/analytics_api analytics_api
#COPY config.toml .
CMD ["./analytics_api"]